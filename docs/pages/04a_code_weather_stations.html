<div class="content-middle">
    <h1>CODE: Weather Station Data Filtering</h1>
    <h2>Hot City, Heated Calls:<br>Understanding Extreme Heat and Quality of Life<br>Using New York City's 311 and SHAP</h2>
    
    <p class="notebook-description">Filtering NOAA GSOD data to extract NYC weather stations (Central Park &amp; JFK).</p>
    
    <div class="notebook-controls">
        <button onclick="toggleAllCode(true)" class="code-toggle-btn">Show All Code</button>
        <button onclick="toggleAllCode(false)" class="code-toggle-btn">Hide All Code</button>
    </div>
    
    <div class="notebook-nav-buttons">
        
        <a href="#" data-page="04b_code_heat_classification" class="notebook-next">1b. Heat Classification →</a>
    </div>
    
    <div class="report-content notebook-content">

<div class="cell-code-wrapper">
    <details class="code-fold">
        <summary class="code-fold-toggle">Code Cell 1</summary>
        <pre class="cell-code"><code>import os
os.getcwd()</code></pre>
    </details>
    
</div>


<div class="cell-code-wrapper">
    <details class="code-fold">
        <summary class="code-fold-toggle">Code Cell 2</summary>
        <pre class="cell-code"><code>import tarfile
from pathlib import Path
import pandas as pd

# ===== 1. PATH TO YOUR GSOD YEAR FILE =====
# change this to your actual file, e.g. 2024.tar.gz or 2025.tar.gz
tar_path = Path(&quot;data/2025.tar.gz&quot;)

# ===== 2. BUILD A STATION TABLE FROM ALL CSVs =====
stations = []

with tarfile.open(tar_path, &quot;r:gz&quot;) as tar:
    for member in tar.getmembers():
        if not member.name.endswith(&quot;.csv&quot;):
            continue  # skip non-csv files

        f = tar.extractfile(member)
        if f is None:
            continue

        df_head = pd.read_csv(f, nrows=1)

        stations.append({
            &quot;file&quot;: member.name,
            &quot;STATION&quot;: df_head.get(&quot;STATION&quot;, [None])[0],
            &quot;NAME&quot;: df_head.get(&quot;NAME&quot;, [None])[0],
            &quot;LATITUDE&quot;: df_head.get(&quot;LATITUDE&quot;, [None])[0],
            &quot;LONGITUDE&quot;: df_head.get(&quot;LONGITUDE&quot;, [None])[0],
        })

stations_df = pd.DataFrame(stations)
print(&quot;Total stations in this year:&quot;, len(stations_df))

# ===== 3. FIND CANDIDATE NYC STATIONS =====
# (1) by rough lat/lon box around NYC
nyc_box = stations_df[
    (stations_df[&quot;LATITUDE&quot;].between(40.5, 41.1)) &amp;
    (stations_df[&quot;LONGITUDE&quot;].between(-74.3, -73.6))
]

print(&quot;\nStations in NYC bounding box:&quot;)
print(nyc_box[[&quot;file&quot;, &quot;STATION&quot;, &quot;NAME&quot;, &quot;LATITUDE&quot;, &quot;LONGITUDE&quot;]])

# (2) by name search (NEW YORK / CENTRAL PARK)
nyc_name = stations_df[
    stations_df[&quot;NAME&quot;].str.contains(&quot;NEW YORK|CENTRAL PARK&quot;, case=False, na=False)
]

print(&quot;\nStations with NEW YORK or CENTRAL PARK in name:&quot;)
print(nyc_name[[&quot;file&quot;, &quot;STATION&quot;, &quot;NAME&quot;, &quot;LATITUDE&quot;, &quot;LONGITUDE&quot;]])
</code></pre>
    </details>
    <div class="cell-outputs">
<pre class="output-stream">Total stations in this year: 11656

Stations in NYC bounding box:
                  file      STATION  \
7356   72055399999.csv  72055399999   
7370   72058100178.csv  72058100178   
8239   72409454743.csv  72409454743   
8436   72502014734.csv  72502014734   
8437   72502594741.csv  72502594741   
8441   72503014732.csv  72503014732   
8443   72503794745.csv  72503794745   
8450   72505394728.csv  72505394728   
9077   74486094789.csv  74486094789   
11179  99727199999.csv  99727199999   
11186  99728099999.csv  99728099999   
11273  99774399999.csv  99774399999   

                                                NAME   LATITUDE  LONGITUDE  
7356   PORT AUTH DOWNTN MANHATTAN WALL ST HEL, NY US  40.701214 -74.009028  
7370                           LINDEN AIRPORT, NJ US  40.617000 -74.250000  
8239                CALDWELL ESSEX CO AIRPORT, NJ US  40.876450 -74.282840  
8436     NEWARK LIBERTY INTERNATIONAL AIRPORT, NJ US  40.682750 -74.169270  
8437                        TETERBORO AIRPORT, NJ US  40.858980 -74.056160  
8441                        LAGUARDIA AIRPORT, NY US  40.779450 -73.880270  
8443                   WESTCHESTER CO AIRPORT, NY US  41.062360 -73.704540  
8450                     NY CITY CENTRAL PARK, NY US  40.778980 -73.969250  
9077                JFK INTERNATIONAL AIRPORT, NY US  40.639150 -73.763900  
11179                                THE BATTERY, US  40.701000 -74.014000  
11186                                KINGS POINT, US  40.811000 -73.765000  
11273                            ROBBINS REEF, NJ US  40.650000 -74.066667  

Stations with NEW YORK or CENTRAL PARK in name:
                 file      STATION                         NAME  LATITUDE  \
8450  72505394728.csv  72505394728  NY CITY CENTRAL PARK, NY US  40.77898   

      LONGITUDE  
8450  -73.96925  
</pre>
</div>
</div>


<div class="cell-code-wrapper">
    <details class="code-fold">
        <summary class="code-fold-toggle">Code Cell 3</summary>
        <pre class="cell-code"><code>import tarfile
import pandas as pd
from pathlib import Path

# ========== You already have these ==========
# stations_df  → a DataFrame containing columns: file, STATION, NAME, LATITUDE, LONGITUDE
# tar_path     → path to 2024.tar.gz (or 2025.tar.gz)

# Directory to save selected station csv
output_dir = Path(&quot;data/nyc_two_stations&quot;)
output_dir.mkdir(exist_ok=True)
</code></pre>
    </details>
    
</div>


<div class="cell-code-wrapper">
    <details class="code-fold">
        <summary class="code-fold-toggle">Code Cell 4</summary>
        <pre class="cell-code"><code># Central Park
cp_row = stations_df[
    stations_df[&quot;NAME&quot;].str.contains(&quot;NY CITY CENTRAL PARK&quot;, case=False, na=False)
].iloc[0]

# JFK
jfk_row = stations_df[
    stations_df[&quot;NAME&quot;].str.contains(&quot;JFK INTERNATIONAL AIRPORT&quot;, case=False, na=False)
].iloc[0]

cp_file = cp_row[&quot;file&quot;]
jfk_file = jfk_row[&quot;file&quot;]

print(&quot;Central Park file:&quot;, cp_file)
print(&quot;JFK file:&quot;, jfk_file)
</code></pre>
    </details>
    <div class="cell-outputs">
<pre class="output-stream">Central Park file: 72505394728.csv
JFK file: 74486094789.csv
</pre>
</div>
</div>


<div class="cell-code-wrapper">
    <details class="code-fold">
        <summary class="code-fold-toggle">Code Cell 5</summary>
        <pre class="cell-code"><code>def read_csv_from_tar(tar_path, csv_file_name):
    with tarfile.open(tar_path, &quot;r:gz&quot;) as tar:
        f = tar.extractfile(csv_file_name)
        return pd.read_csv(f)

cp_data = read_csv_from_tar(tar_path, cp_file)
jfk_data = read_csv_from_tar(tar_path, jfk_file)

cp_out = output_dir / &quot;NYC_Central_Park.csv&quot;
jfk_out = output_dir / &quot;NYC_JFK_Airport.csv&quot;

cp_data.to_csv(cp_out, index=False)
jfk_data.to_csv(jfk_out, index=False)

print(&quot;Saved:&quot;, cp_out)
print(&quot;Saved:&quot;, jfk_out)</code></pre>
    </details>
    <div class="cell-outputs">
<pre class="output-stream">Saved: data\nyc_two_stations\NYC_Central_Park.csv
Saved: data\nyc_two_stations\NYC_JFK_Airport.csv
</pre>
</div>
</div>

    </div>
    
    <div class="notebook-nav-buttons notebook-nav-bottom">
        
        <a href="#" data-page="04b_code_heat_classification" class="notebook-next">1b. Heat Classification →</a>
    </div>
</div>

<div class="content-right">
    <div class="panel-right-content">
        <h2>Notebooks</h2>
        <ul class="notebook-nav-list">
            <li class="notebook-nav-current"><a href="#" data-page="04a_code_weather_stations">1a. Weather Stations</a></li>
<li class=""><a href="#" data-page="04b_code_heat_classification">1b. Heat Classification</a></li>
<li class=""><a href="#" data-page="04c_code_311_processing">2. 311 Processing</a></li>
<li class=""><a href="#" data-page="04d_code_census_acs">3. Census ACS</a></li>
<li class=""><a href="#" data-page="04e_code_additional_features">4. Additional Features</a></li>
<li class=""><a href="#" data-page="04f_code_nlcd_rasters">5. NLCD Rasters</a></li>
<li class=""><a href="#" data-page="04g_code_data_merging">6. Data Merging</a></li>
<li class=""><a href="#" data-page="04h_code_eda">7. EDA</a></li>
<li class=""><a href="#" data-page="04i_code_ols_ml_shap">8. OLS & ML + SHAP</a></li>
        </ul>
        
        <h2>This Notebook</h2>
        <p><b>Source:</b> 01a_weather_station_data_filtering.ipynb</p>
        <p><b>Code Cells:</b> 5</p>
        <p><b>Figures:</b> 0</p>
    </div>
    <div class="panel-right-footer">
        <h3>Data Pipeline</h3>
        <h5>Weather → 311 → Census → Features → Merge → EDA → Modeling</h5>
    </div>
</div>